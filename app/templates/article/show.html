<!DOCTYPE html>
<!--
  ~ Copyright (C) 2016 Álvaro Orduna León
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU General Public License as published by
  ~ the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU General Public License for more details.
  ~
  ~ You should have received a copy of the GNU General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<html lang="es">
<head>
    ##HEAD##

    <!-- Article/Blog style -->
    <link href="##BASE_URL##/public/css/article.css" rel="stylesheet" type="text/css"/>
</head>
<body>

##HEADER##

<main id="content">
    <article class="article">
        <header>
            <h2 class="title">##ARTICLE_TITLE##</h2>
        </header>
        <p class="meta">
            <span class="date">##ARTICLE_TIME##</span>
            <span class="author">Publicado por <a ##ARTICLE_AUTHOR_LINK##>##ARTICLE_AUTHOR##</a></span>
        </p>
        <div class="body markdown">##ARTICLE_BODY##</div>
        <img id="image-medium" width="100%">
        <ul id="images-small"></ul>
        <div class="actions">
            <a href="##BASE_URL##/article/print/##ARTICLE_ID##" target="_blank">Imprimir</a>
        </div>
    </article>
</main>

##FOOTER##

<script type="application/javascript">
    var imagesArray;

    $.ajax({
        type: 'POST',
        dataType: 'json',
        url: '##BASE_URL##/api/blog/images/##ARTICLE_ID##',
        data: null,
        success: onImagesRequest
    });

    function onImagesRequest(data) {
        imagesArray = data;
        var imageUri, imageLi, image;
        for (var i = 0; i < imagesArray.length; i++) {
            if (i == 0) {
                imageUri = imagesArray[i].medium;
                document.getElementById("image-medium").src = imageUri;
            }

            imageUri = imagesArray[i].small;

            image = document.createElement('img');
            image.src = imageUri;
            image.onclick = onSmallImageClickListener;

            imageLi = document.createElement('li');
            imageLi.appendChild(image);

            document.getElementById("images-small").appendChild(imageLi);
        }
    }

    function onSmallImageClickListener() {
        for (var i = 0; i < imagesArray.length; i++) {
            if (imagesArray[i].small.split("/").pop() == this.src.split("/").pop()) {
                var image = $("#image-medium");
                var uri = imagesArray[i].medium;
                image.fadeOut('fast', function () {
                    image.attr('src', uri);
                    image.fadeIn(500);
                });
            }
        }
    }
</script>

</body>
</html>
